<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow - Todo App</title>
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Load Heroicons for UI icons -->
    <script type="module" src="https://unpkg.com/heroicons@2.1.1/24/outline/index.js"></script>
    <script type="module" src="https://unpkg.com/heroicons@2.1.1/24/solid/index.js"></script>
    
    <!-- 3. Configure Tailwind for Inter font and dark mode -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        };
    </script>
    
    <!-- 4. Custom Styles -->
    <style type="text/css">
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* cool-gray-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* cool-gray-400 */
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4b5563; /* gray-600 */
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* gray-500 */
        }
        
        /* Hide element */
        .hidden {
            display: none;
        }

        /* Priority Badge Colors */
        .priority-low {
            background-color: #dbeafe;
            color: #2563eb;
        }
        .dark .priority-low {
            background-color: #1e3a8a; 
            color: #60a5fa;
        }
        .priority-medium {
            background-color: #fef3c7; 
            color: #d97706; 
        }
        .dark .priority-medium {
            background-color: #78350f; 
            color: #fcd34d; 
        }
        .priority-high {
            background-color: #fee2e2;
            color: #dc2626;
        }
        .dark .priority-high {
            background-color: #7f1d1d; 
            color: #f87171; 
        }
    </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">

    <!-- ===================================================================== -->
    <!-- LOGIN VIEW -->
    <!-- This view is shown if no user is "logged in" (in localStorage) -->
    <!-- ===================================================================== -->
    <div id="login-view" class="hidden min-h-screen flex items-center justify-center px-4">
        <div class="w-full max-w-md p-8 bg-white dark:bg-gray-800 rounded-xl shadow-2xl space-y-6">
            <div class="flex items-center justify-center space-x-2">
                <!-- Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 text-blue-600 dark:text-blue-500">
                    <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm.53 5.47a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72v5.69a.75.75 0 0 0 1.5 0v-5.69l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z" clip-rule="evenodd" />
                </svg>
                <h1 class="text-3xl font-bold text-center text-gray-900 dark:text-white">TaskFlow</h1>
            </div>
            <p class="text-center text-gray-600 dark:text-gray-300">
                Welcome! Enter a username to get started.
            </p>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Username</label>
                    <input type="text" id="username" name="username" required
                        class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <button type="submit"
                    class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900">
                    Login / Sign Up
                </button>
            </form>
            <p class="text-xs text-center text-gray-500 dark:text-gray-400">
                No password needed. This demo uses local storage to save your tasks to your browser.
            </p>
        </div>
    </div>

    <!-- ===================================================================== -->
    <!-- MAIN APP VIEW -->
    <!-- This view is shown after "login" -->
    <!-- ===================================================================== -->
    <div id="app-view" class="hidden min-h-screen">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <!-- Left: Logo & User -->
                    <div class="flex items-center space-x-2 sm:space-x-4">
                        <div class="flex-shrink-0 flex items-center space-x-2">
                             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7 text-blue-600 dark:text-blue-500">
                                <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm.53 5.47a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72v5.69a.75.75 0 0 0 1.5 0v-5.69l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z" clip-rule="evenodd" />
                            </svg>
                            <h1 class="text-xl font-bold text-gray-900 dark:text-white">TaskFlow</h1>
                        </div>
                        <span class="text-gray-500 dark:text-gray-400 hidden sm:inline">|</span>
                        <div class="hidden sm:flex items-center space-x-2">
                            <span class="text-sm font-medium text-gray-600 dark:text-gray-300 hidden sm:inline">Welcome,</span>
                            <span id="user-display" class="text-sm font-bold text-blue-600 dark:text-blue-400">User</span>
                        </div>
                    </div>
                    <!-- Right: Actions -->
                    <div class="flex items-center space-x-2 sm:space-x-3">
                        <button id="add-task-btn"
                            class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-medium p-2 sm:py-2 sm:px-4 rounded-lg shadow-sm text-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                                <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z" clip-rule="evenodd" />
                            </svg>
                            <span class="hidden sm:inline">Add Task</span>
                        </button>
                        <button id="dark-mode-toggle" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700">
                            <!-- Sun icon (light mode) -->
                            <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                                <path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.899 6.101a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.061l1.591-1.59ZM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5h2.25a.75.75 0 0 1 .75.75ZM17.803 17.803a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.06l1.591-1.59ZM12 18a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0v-2.25A.75.75 0 0 1 12 18ZM6.101 17.803a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.06l1.591-1.59ZM4.5 12a.75.75 0 0 1-.75.75H2.25a.75.75 0 0 1 0-1.5h2.25a.75.75 0 0 1 .75.75ZM6.101 6.101a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 0 0 1.06 1.061l1.591-1.59Z" />
                            </svg>
                            <!-- Moon icon (dark mode) -->
                            <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 hidden">
                                <path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6.75c0 4.97 4.03 9 9 9 2.53 0 4.841-1.04 6.472-2.75a.75.75 0 0 1 1.06.02L23 15a.75.75 0 0 1-.88.951A11.953 11.953 0 0 1 12.5 21a11.953 11.953 0 0 1-10.05-5.978.75.75 0 0 1 .33-.884l1.758-.879Z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <button id="logout-btn" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                                <path fill-rule="evenodd" d="M7.5 3.75A1.5 1.5 0 0 0 6 5.25v13.5a1.5 1.5 0 0 0 1.5 1.5h6a1.5 1.5 0 0 0 1.5-1.5V15a.75.75 0 0 1 1.5 0v3.75a3 3 0 0 1-3 3h-6a3 3 0 0 1-3-3V5.25a3 3 0 0 1 3-3h6a3 3 0 0 1 3 3V9A.75.75 0 0 1 15 9V5.25a1.5 1.5 0 0 0-1.5-1.5h-6Zm10.72 4.72a.75.75 0 0 1 1.06 0l3 3a.75.75 0 0 1 0 1.06l-3 3a.75.75 0 1 1-1.06-1.06l1.72-1.72H9a.75.75 0 0 1 0-1.5h10.94l-1.72-1.72a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Filters & Search -->
            <div class="mb-6 grid grid-cols-1 sm:grid-cols-3 gap-4">
                <!-- Search -->
                <div class="sm:col-span-1">
                    <label for="search-input" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Search Tasks</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 text-gray-400 dark:text-gray-500">
                                <path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <input type="text" id="search-input" placeholder="e.g. Design homepage"
                            class="block w-full pl-10 pr-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                <!-- Filter by Status -->
                <div class="sm:col-span-1">
                    <label for="filter-status" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Status</label>
                    <select id="filter-status"
                        class="mt-1 block w-full pl-3 pr-10 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option value="all">All</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                    </select>
                </div>
                <!-- Filter by Priority -->
                <div class="sm:col-span-1">
                    <label for="filter-priority" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Priority</label>
                    <select id="filter-priority"
                        class="mt-1 block w-full pl-3 pr-10 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option value="all">All Priorities</option>
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                    </select>
                </div>
            </div>

            <!-- Tabs -->
            <div class="mb-4 border-b border-gray-200 dark:border-gray-700 overflow-x-auto">
                <nav id="task-tabs" class="-mb-px flex space-x-4 sm:space-x-8" aria-label="Tabs">
                    <button data-tab="all" class="tab-btn whitespace-nowrap py-4 px-2 sm:px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400">
                        All Tasks
                    </button>
                    <button data-tab="In Progress" class="tab-btn whitespace-nowrap py-4 px-2 sm:px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-600">
                        In Progress
                    </button>
                    <button data-tab="Completed" class="tab-btn whitespace-nowrap py-4 px-2 sm:px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-600">
                        Completed
                    </button>
                </nav>
            </div>

            <!-- Task List -->
            <div id="task-list" class="space-y-4">
                <!-- Task cards will be injected here by JavaScript -->
                
                <!-- Empty State Example (shown by JS when list is empty) -->
                <div id="empty-state" class="hidden text-center py-12 px-4">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-16 h-16 mx-auto text-gray-400 dark:text-gray-500">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                    </svg>
                    <h3 class="mt-2 text-xl font-semibold text-gray-900 dark:text-white">No tasks found</h3>
                    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Get started by adding a new task.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- ===================================================================== -->
    <!-- MODALS -->
    <!-- ===================================================================== -->

    <!-- Task Form Modal (Add/Edit) -->
    <div id="task-form-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center">
            <!-- Background overlay -->
            <div class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-80 transition-opacity" aria-hidden="true"></div>

            <!-- Modal content -->
            <div class="inline-block bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <form id="task-form">
                    <div class="px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white" id="modal-title">Add New Task</h3>
                        <input type="hidden" id="task-id">
                        
                        <div class="mt-4 space-y-4">
                            <!-- Title -->
                            <div>
                                <label for="task-title" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Title</label>
                                <input type="text" id="task-title" required
                                    class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <!-- Description -->
                            <div>
                                <label for="task-description" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Description</label>
                                <textarea id="task-description" rows="3"
                                    class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>
                            <!-- Due Date -->
                            <div>
                                <label for="task-due-date" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Due Date</label>
                                <input type="date" id="task-due-date"
                                    class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <!-- Priority -->
                            <div>
                                <label for="task-priority" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Priority</Labe>
                                <select id="task-priority"
                                    class="mt-1 block w-full pl-3 pr-10 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    <option value="Low">Low</option>
                                    <option value="Medium" selected>Medium</option>
                                    <option value="High">High</option>
                                </select>
                            </div>
                             <!-- Status (only show when editing) -->
                            <div id="status-field-group" class="hidden">
                                <label for="task-status" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Status</Labe>
                                <select id="task-status"
                                    class="mt-1 block w-full pl-3 pr-10 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    <option value="In Progress">In Progress</option>
                                    <option value="Completed">Completed</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 sm:ml-3 sm:w-auto sm:text-sm">
                            Save Task
                        </button>
                        <button type="button" id="cancel-task-form"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 dark:focus:ring-offset-gray-800 sm:mt-0 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center">
            <div class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-80 transition-opacity" aria-hidden="true"></div>

            <div class="inline-block bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="px-4 pt-5 pb-4 sm:p-6">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900 sm:mx-0 sm:h-10 sm:w-10">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-red-600 dark:text-red-400">
                                <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.72 6.97a.75.75 0 1 0-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 1 0 1.06 1.06L12 13.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L13.06 12l1.72-1.72a.75.75 0 1 0-1.06-1.06L12 10.94l-1.72-1.72Z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Delete Task</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500 dark:text-gray-400">
                                    Are you sure you want to delete this task? This action cannot be undone.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="confirm-delete-btn"
                        class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 dark:focus:ring-offset-gray-800 sm:ml-3 sm:w-auto sm:text-sm">
                        Delete
                    </button>
                    <button type="button" id="cancel-delete-btn"
                        class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 dark:focus:ring-offset-gray-800 sm:mt-0 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- ===================================================================== -->
    <!-- JAVASCRIPT LOGIC -->
    <!-- ===================================================================== -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // === STATE ===
            let tasks = [];
            let currentUser = null;
            let currentFilters = {
                status: 'all', // 'all', 'In Progress', 'Completed'
                priority: 'all', // 'all', 'Low', 'Medium', 'High'
                search: '',
                tab: 'all' // 'all', 'In Progress', 'Completed'
            };
            let taskIdToDelete = null;
            let editingTaskId = null;

            // === LOCAL STORAGE KEYS ===
            const USER_KEY_PREFIX = 'taskflow_user_';
            const CURRENT_USER_KEY = 'taskflow_current_user';
            const THEME_KEY = 'taskflow_theme';

            // === DOM ELEMENTS ===
            // Views
            const loginView = document.getElementById('login-view');
            const appView = document.getElementById('app-view');

            // Login
            const loginForm = document.getElementById('login-form');
            const usernameInput = document.getElementById('username');

            // App Header
            const userDisplay = document.getElementById('user-display');
            const addTaskBtn = document.getElementById('add-task-btn');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const themeIconLight = document.getElementById('theme-icon-light');
            const themeIconDark = document.getElementById('theme-icon-dark');
            const logoutBtn = document.getElementById('logout-btn');

            // Filters & Tabs
            const searchInput = document.getElementById('search-input');
            const filterStatus = document.getElementById('filter-status');
            const filterPriority = document.getElementById('filter-priority');
            const taskTabs = document.getElementById('task-tabs');

            // Task List
            const taskList = document.getElementById('task-list');
            const emptyState = document.getElementById('empty-state');

            // Task Form Modal
            const taskFormModal = document.getElementById('task-form-modal');
            const taskForm = document.getElementById('task-form');
            const modalTitle = document.getElementById('modal-title');
            const taskIdInput = document.getElementById('task-id');
            const taskTitleInput = document.getElementById('task-title');
            const taskDescriptionInput = document.getElementById('task-description');
            const taskDueDateInput = document.getElementById('task-due-date');
            const taskPriorityInput = document.getElementById('task-priority');
            const statusFieldGroup = document.getElementById('status-field-group');
            const taskStatusInput = document.getElementById('task-status');
            const cancelTaskFormBtn = document.getElementById('cancel-task-form');

            // Delete Modal
            const deleteModal = document.getElementById('delete-modal');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
            const cancelDeleteBtn = document.getElementById('cancel-delete-btn');

            // === INITIALIZATION ===
            function init() {
                // 1. Check for saved theme
                const savedTheme = localStorage.getItem(THEME_KEY);
                if (savedTheme === 'dark') {
                    document.documentElement.classList.add('dark');
                    themeIconLight.classList.add('hidden');
                    themeIconDark.classList.remove('hidden');
                } else {
                    document.documentElement.classList.remove('dark');
                    themeIconLight.classList.remove('hidden');
                    themeIconDark.classList.add('hidden');
                }

                // 2. Check for logged-in user
                currentUser = localStorage.getItem(CURRENT_USER_KEY);
                if (currentUser) {
                    showAppView();
                } else {
                    showLoginView();
                }

                // 3. Add all event listeners
                addEventListeners();
            }

            function showAppView() {
                loginView.classList.add('hidden');
                appView.classList.remove('hidden');
                userDisplay.textContent = currentUser;
                loadTasks();
                renderTasks();
            }

            function showLoginView() {
                appView.classList.add('hidden');
                loginView.classList.remove('hidden');
            }

            // === DATA PERSISTENCE (LOCAL STORAGE) ===
            function loadTasks() {
                const userTaskKey = `${USER_KEY_PREFIX}${currentUser}`;
                const savedTasks = localStorage.getItem(userTaskKey);
                tasks = savedTasks ? JSON.parse(savedTasks) : getSampleTasks();
            }
            
            function saveTasks() {
                const userTaskKey = `${USER_KEY_PREFIX}${currentUser}`;
                localStorage.setItem(userTaskKey, JSON.stringify(tasks));
            }
            
            function getSampleTasks() {
                // Return a few sample tasks if the user is new
                return [
                    {
                        id: 'task-1',
                        title: 'Design homepage mockup',
                        description: 'Create a high-fidelity mockup in Figma for the new homepage.',
                        dueDate: '2025-10-28',
                        priority: 'High',
                        status: 'In Progress'
                    },
                    {
                        id: 'task-2',
                        title: 'Develop API endpoints',
                        description: 'Build REST endpoints for tasks (GET, POST, PUT, DELETE).',
                        dueDate: '2025-10-30',
                        priority: 'Medium',
                        status: 'In Progress'
                    },
                    {
                        id: 'task-3',
                        title: 'Write project documentation',
                        description: 'Document the API and frontend components.',
                        dueDate: '2025-11-01',
                        priority: 'Low',
                        status: 'In Progress'
                    },
                    {
                        id: 'task-4',
                        title: 'Review pull request',
                        description: 'Review the new authentication feature branch.',
                        dueDate: '2025-10-24',
                        priority: 'Medium',
                        status: 'Completed'
                    }
                ];
            }


            // === RENDERING ===
            function renderTasks() {
                taskList.innerHTML = ''; // Clear existing list

                // 1. Filter tasks based on current filters
                const filteredTasks = tasks.filter(task => {
                    const matchesSearch = task.title.toLowerCase().includes(currentFilters.search.toLowerCase()) ||
                                          task.description.toLowerCase().includes(currentFilters.search.toLowerCase());
                    const matchesStatus = currentFilters.status === 'all' || task.status === currentFilters.status;
                    const matchesPriority = currentFilters.priority === 'all' || task.priority === currentFilters.priority;
                    const matchesTab = currentFilters.tab === 'all' || task.status === currentFilters.tab;

                    return matchesSearch && matchesStatus && matchesPriority && matchesTab;
                });

                // 2. Show empty state if no tasks
                if (filteredTasks.length === 0) {
                    emptyState.classList.remove('hidden');
                } else {
                    emptyState.classList.add('hidden');
                }

                // 3. Create and append task cards
                filteredTasks.forEach(task => {
                    const taskCard = createTaskCard(task);
                    taskList.appendChild(taskCard);
                });
            }

            function createTaskCard(task) {
                const card = document.createElement('div');
                card.className = `bg-white dark:bg-gray-800 rounded-lg shadow-md p-5 transition-all hover:shadow-lg border-l-4 ${task.status === 'Completed' ? 'border-green-500' : 'border-blue-500'}`;
                card.dataset.taskId = task.id;

                const priorityClass = `priority-${task.priority.toLowerCase()}`;
                
                const formattedDate = task.dueDate 
                    ? new Date(task.dueDate + 'T00:00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) 
                    : 'No due date';

                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <!-- Left side: Checkbox and Content -->
                        <div class="flex items-start space-x-4 min-w-0">
                            <!-- Custom Checkbox -->
                            <button class="toggle-complete-btn flex-shrink-0 mt-1 w-5 h-5 rounded-full border-2 ${task.status === 'Completed' ? 'border-green-500 bg-green-500' : 'border-gray-400 dark:border-gray-500'} flex items-center justify-center transition-colors" data-task-id="${task.id}">
                                ${task.status === 'Completed' ? '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-white"><path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z" clip-rule="evenodd" /></svg>' : ''}
                            </button>
                            
                            <!-- Text Content -->
                            <div class="min-w-0">
                                <p class="font-semibold text-lg truncate ${task.status === 'Completed' ? 'line-through text-gray-500 dark:text-gray-400' : 'text-gray-900 dark:text-white'}">${task.title}</p>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mt-1 break-words">${task.description || 'No description.'}</p>
                                
                                <!-- Meta Info -->
                                <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 space-y-2 sm:space-y-0 mt-3 items-start sm:items-center text-sm text-gray-500 dark:text-gray-400">
                                    <!-- Due Date -->
                                    <div class="flex items-center space-x-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 flex-shrink-0"><path fill-rule="evenodd" d="M5.75 2a.75.75 0 0 1 .75.75V4h7V2.75a.75.75 0 0 1 1.5 0V4h.25A2.75 2.75 0 0 1 18 6.75v8.5A2.75 2.75 0 0 1 15.25 18H4.75A2.75 2.75 0 0 1 2 15.25v-8.5A2.75 2.75 0 0 1 4.75 4H5V2.75A.75.75 0 0 1 5.75 2Zm-1 5.5h10.5a.75.75 0 0 0 0-1.5H4.75a.75.75 0 0 0 0 1.5Z" clip-rule="evenodd" /></svg>
                                        <span>${formattedDate}</span>
                                    </div>
                                    <!-- Priority Badge -->
                                    <span class="px-2.5 py-0.5 rounded-full text-xs font-medium ${priorityClass}">
                                        ${task.priority}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right side: Actions -->
                        <div class="flex-shrink-0 flex items-center space-x-0 sm:space-x-1 pl-2">
                            <button class="edit-btn p-2 rounded-full text-gray-400 hover:text-blue-600 hover:bg-gray-100 dark:hover:bg-gray-700" data-task-id="${task.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="m2.695 14.762-1.262 3.155a.5.5 0 0 0 .65.65l3.155-1.262a4 4 0 0 0 1.343-.886L17.5 5.502a2.121 2.121 0 0 0-3-3L3.58 13.42a4 4 0 0 0-.885 1.343Z" /></svg>
                            </button>
                            <button class="delete-btn p-2 rounded-full text-gray-400 hover:text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700" data-task-id="${task.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.58.22-2.34.425a.75.75 0 0 0-.5.872l.823 2.47a.75.75 0 0 0 .872.5l2.34-.424a.75.75 0 0 0 .5-.872l-.823-2.47a.75.75 0 0 0-.872-.5l-2.34.424A8.98 8.98 0 0 1 6 3.75a1.25 1.25 0 0 1 1.25-1.25h5A1.25 1.25 0 0 1 13.5 3.75v.443c.795.077 1.58.22 2.34.425a.75.75 0 0 0 .5.872l-.823 2.47a.75.75 0 0 0-.872.5l-2.34-.424a.75.75 0 0 0-.5.872l.823 2.47a.75.75 0 0 0 .872.5l2.34-.424c.76-.135 1.545-.248 2.34-.322V16.25A2.75 2.75 0 0 1 13.75 19h-7.5A2.75 2.75 0 0 1 3.5 16.25V7.918c.795.074 1.58.187 2.34.322a.75.75 0 0 0 .872-.5l.823-2.47a.75.75 0 0 0-.5-.872l-2.34.424a.75.75 0 0 0-.872.5l-.823 2.47a.75.75 0 0 0 .5.872l2.34-.425A8.98 8.98 0 0 1 3.5 7.918V3.75A2.75 2.75 0 0 1 6.25 1h7.5Z" clip-rule="evenodd" /></svg>
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listeners to buttons on the card
                card.querySelector('.toggle-complete-btn').addEventListener('click', handleToggleComplete);
                card.querySelector('.edit-btn').addEventListener('click', handleEditTask);
                card.querySelector('.delete-btn').addEventListener('click', handleDeleteTask);
                
                return card;
            }

            // === MODAL HANDLING ===
            function showTaskForm(task = null) {
                taskForm.reset();
                if (task) {
                    // Edit mode
                    editingTaskId = task.id;
                    modalTitle.textContent = 'Edit Task';
                    taskIdInput.value = task.id;
                    taskTitleInput.value = task.title;
                    taskDescriptionInput.value = task.description;
                    taskDueDateInput.value = task.dueDate;
                    taskPriorityInput.value = task.priority;
                    taskStatusInput.value = task.status;
                    statusFieldGroup.classList.remove('hidden');
                } else {
                    // Add mode
                    editingTaskId = null;
                    modalTitle.textContent = 'Add New Task';
                    taskIdInput.value = '';
                    taskPriorityInput.value = 'Medium'; // Default
                    statusFieldGroup.classList.add('hidden');
                }
                taskFormModal.classList.remove('hidden');
            }

            function hideTaskForm() {
                taskFormModal.classList.add('hidden');
            }

            function showDeleteModal(taskId) {
                taskIdToDelete = taskId;
                deleteModal.classList.remove('hidden');
            }

            function hideDeleteModal() {
                taskIdToDelete = null;
                deleteModal.classList.add('hidden');
            }

            // === EVENT HANDLERS ===
            function addEventListeners() {
                // Login
                loginForm.addEventListener('submit', handleLogin);
                logoutBtn.addEventListener('click', handleLogout);
                
                // Theme
                darkModeToggle.addEventListener('click', handleToggleDarkMode);

                // Filters & Tabs
                searchInput.addEventListener('input', handleFilterChange);
                filterStatus.addEventListener('change', handleFilterChange);
                filterPriority.addEventListener('change', handleFilterChange);
                taskTabs.addEventListener('click', handleTabClick);

                // Task Actions
                addTaskBtn.addEventListener('click', () => showTaskForm());

                // Task Form Modal
                taskForm.addEventListener('submit', handleTaskFormSubmit);
                cancelTaskFormBtn.addEventListener('click', hideTaskForm);

                // Delete Modal
                confirmDeleteBtn.addEventListener('click', handleConfirmDelete);
                cancelDeleteBtn.addEventListener('click', hideDeleteModal);
            }

            // --- Authentication Handlers ---
            function handleLogin(e) {
                e.preventDefault();
                const user = usernameInput.value.trim();
                if (user) {
                    currentUser = user;
                    localStorage.setItem(CURRENT_USER_KEY, currentUser);
                    showAppView();
                }
            }
            
            function handleLogout() {
                currentUser = null;
                localStorage.removeItem(CURRENT_USER_KEY);
                showLoginView();
            }

            // --- Theme Handler ---
            function handleToggleDarkMode() {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem(THEME_KEY, 'light');
                    themeIconLight.classList.remove('hidden');
                    themeIconDark.classList.add('hidden');
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem(THEME_KEY, 'dark');
                    themeIconLight.classList.add('hidden');
                    themeIconDark.classList.remove('hidden');
                }
            }

            // --- Filter & Tab Handlers ---
            function handleFilterChange() {
                currentFilters.search = searchInput.value;
                currentFilters.status = filterStatus.value;
                currentFilters.priority = filterPriority.value;
                renderTasks();
            }
            
            function handleTabClick(e) {
                const clickedTab = e.target.closest('.tab-btn');
                if (!clickedTab) return;

                const tabValue = clickedTab.dataset.tab;
                currentFilters.tab = tabValue;

                // Update active tab styles
                document.querySelectorAll('#task-tabs .tab-btn').forEach(btn => {
                    btn.classList.remove('border-blue-500', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400');
                    btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-200', 'dark:hover:border-gray-600');
                });
                
                clickedTab.classList.add('border-blue-500', 'text-blue-600', 'dark:border-blue-400', 'dark:text-blue-400');
                clickedTab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-200', 'dark:hover:border-gray-600');

                // When a tab is clicked, it overrides the status dropdown
                filterStatus.value = 'all';
                currentFilters.status = 'all';

                renderTasks();
            }

            // --- Task CRUD Handlers ---
            function handleTaskFormSubmit(e) {
                e.preventDefault();

                const taskData = {
                    id: editingTaskId || `task-${new Date().getTime()}`,
                    title: taskTitleInput.value.trim(),
                    description: taskDescriptionInput.value.trim(),
                    dueDate: taskDueDateInput.value,
                    priority: taskPriorityInput.value,
                    status: editingTaskId ? taskStatusInput.value : 'In Progress' // Default to 'In Progress' for new tasks
                };
                
                if (!taskData.title) {
                    // We'll use a custom modal for alerts later, but for now, this is fine.
                    console.warn('Task title is required.');
                    // Simple validation feedback
                    taskTitleInput.classList.add('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
                    taskTitleInput.addEventListener('input', () => {
                         taskTitleInput.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
                    }, { once: true });
                    return;
                }
                
                if (editingTaskId) {
                    // Update existing task
                    tasks = tasks.map(task => task.id === editingTaskId ? taskData : task);
                } else {
                    // Add new task
                    tasks.unshift(taskData); // Add to the beginning of the list
                }
                
                editingTaskId = null;
                saveTasks();
                renderTasks();
                hideTaskForm();
            }

            function handleToggleComplete(e) {
                const taskId = e.currentTarget.dataset.taskId;
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    task.status = task.status === 'Completed' ? 'In Progress' : 'Completed';
                    saveTasks();
                    renderTasks();
                }
            }

            function handleEditTask(e) {
                const taskId = e.currentTarget.dataset.taskId;
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    showTaskForm(task);
                }
            }

            function handleDeleteTask(e) {
                const taskId = e.currentTarget.dataset.taskId;
                showDeleteModal(taskId);
            }

            function handleConfirmDelete() {
                if (taskIdToDelete) {
                    tasks = tasks.filter(task => task.id !== taskIdToDelete);
                    saveTasks();
                    renderTasks();
                    hideDeleteModal();
                }
            }

            // === START THE APP ===
            init();
        });
    </script>

</body>
</html>



